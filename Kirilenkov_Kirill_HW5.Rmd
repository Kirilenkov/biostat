# Импорты

```{r}
# импорт библиотек
library(tidyverse)
library(car)
library(survival)
library(ggsurvfit)
library(survminer)
```
# Загрузка сета данных
```{r}
df <- read.csv("wisconsin_breast_cancer.csv")
head(df)
```

# Задание 1

# Модель линейной регрессии

```{r}
# построение модели линейной регрессии 
fit <- lm(radius_mean ~ area_mean + perimeter_mean + symmetry_mean, data = df) 
summary(fit)
```

```{r}
df %>%
    ggplot(aes(x = radius_mean, y = perimeter_mean)) +
    geom_point() +
    labs(title = "средний радиус опухоли vs средний периметр опухоли",
      x = "средний радиус опухоли",
      y = "средний периметр опухоли") + 
    geom_smooth(formula = y ~ x, method = "lm")
```

```{r}
df %>%
    ggplot(aes(x = area_mean, y = radius_mean)) +
    geom_point() +
    labs(title = "Cредняя площадь vs средний радиус опухоли",
      x = "Cредняя площадь",
      y = "Средний радиус опухоли") +
    geom_smooth(method = "lm")
    geom_smooth(formula = y ~ x, method = "lm")
```

```{r}
df %>%
    ggplot(aes(x = radius_mean, y = symmetry_mean)) +
    geom_point() +
    labs(title = "средний радиус опухоли vs cредняя симметричность опухоли",
      x = "средний радиус опухоли",
      y = "средняя симметричность опухоли") +
    geom_smooth(method = "lm")
    geom_smooth(formula = y ~ x, method = "lm")
```

Распределение остатков модели характеризуется следующими статистиками: минимальное и максимальное значения остатков, медиана и интерквартильный размах (разница между третьим и первым квартилем).
Коэффициенты (оценки) модели демонстрируют, как изменяется средний радиус опухоли при увеличении значений предикторов на одну единицу. Например, при увеличении средней площади и среднего периметра опухоли, средний радиус увеличивается на 0.0007 и 0.135 соответственно. В то же время увеличение средней симметричности приводит к уменьшению среднего радиуса опухоли на 4.35.
Значение коэффициента пересечения (интерсепта) указывает ожидаемый средний радиус опухоли, когда все предикторы равны нулю.
Значение p-value для всех предикторов оказалось статистически значимым (p-value < alpha), что подтверждает наличие линейной зависимости между средним радиусом опухоли и изучаемыми факторами.
Общее значение статистики F-statistics для модели составило 6.511e+04.
Общее значение p-value для модели меньше 2.2e-16.
Остаточная стандартная ошибка модели равна 0.1898.
Скорректированный коэффициент детерминации (adjusted R-squared) равен 0.9971, что указывает на то, что модель объясняет 99.7% вариативности среднего радиуса опухоли. Это может свидетельствовать как о высоком качестве модели, так и о возможном переобучении из-за несоблюдения предположений или ограничений, что делает предсказания менее надежными.



По графикам видно, что факторы периметра и площади опухоли имеют сильную линейную зависимость с зависимой переменной. При этом фактор симметричности опухоли имеет бОльшую дисперсию и менее сильную линейную зависимость с радиусом опухоли в качестве зависимой переменной.


# Задание 2

# Подготовка данных

```{r}
df$diagnosis <- ifelse(df$diagnosis == 'M', 1, 0)
```

# Модель логистической регрессии вариант 1

```{r}
logreg <-
  glm(diagnosis ~ radius_mean + area_mean + texture_mean,
  data = df, family = "binomial")
summary(logreg)
```
# Модель логистической регрессии вариант 2 со взаимодейстивем факторов друг с другом
```{r}
logreg2 <-
  glm(diagnosis ~ radius_mean * area_mean * texture_mean,
      data = df,
      family = "binomial")

summary(logreg2)
exp(coefficients(logreg2))
```

```{r}
df %>%
    ggplot(aes(x = radius_mean, y = diagnosis)) +
    geom_point() +
    labs(title = "Тип опухоли vs cредний радиус опухоли",
      x = "Средний радиус опухоли",
      y = "Тип опухоли") +
    geom_smooth(method = "glm", 
                method.args = list(family = "binomial")) +
  theme_bw()
```

```{r}
df %>%
    ggplot(aes(x = area_mean, y = diagnosis)) +
    geom_point() +
    labs(title = "Тип опухоли vs cредняя площадь опухоли",
      x = "Средняя площадь опухоли",
      y = "Тип опухоли") +
    geom_smooth(method = "glm", 
                method.args = list(family = "binomial")) +
  theme_bw()
```

```{r}
df %>%
    ggplot(aes(x = texture_mean, y = diagnosis)) +
    geom_point() +
    labs(title = "Тип опухоли vs средняя текстура опухоли",
      x = "Средняя текстура опухоли",
      y = "Тип опухоли") +
    geom_smooth(method = "glm", 
                method.args = list(family = "binomial")) +
  theme_bw()
```

# Задание 3


```{r}
df2 <- survival::lung
head(lung)
```

# переменная event, в которой отражает наличие или отсутствие (1 или 0) интересующего события — смерти пациента.

```{r}
df2$event <- ifelse(lung$status == 2,1,0)
```

# Данные только по умершим

```{r}
df_dead <- filter(lung,lung$event == 1)
```

# Кривые выживаемости в зависимости от пола

```{r}
surv_fit <- survfit(Surv(time, status) ~ sex, data = df_dead)
ggsurvplot(surv_fit, conf.int = TRUE, surv.median.line = 'hv', risk.table = TRUE)
```
# Лог-ранг тест

```{r}
survdiff(Surv(time, status) ~ sex, data = df_dead)
```

В таблице представлены две строки, соответствующие двум группам, разделённым на основе половой принадлежности. В колонке "N" указано общее количество индивидуумов в каждой группе, а колонки "Observed" и "Expected" показывают фактическое и теоретически ожидаемое количество случаев соответственно.

Значение P-value составляет 0.1, что означает, что p-value больше установленного уровня значимости alpha. Это подразумевает, что у нас нет достаточных оснований отклонить нулевую гипотезу, и мы принимаем её. Следовательно, нет статистически подтверждённого различия в показателе выживаемости между двумя группами, разделёнными по половому признаку.

# График кумулятивной функции рисков по полу

```{r}
ggsurvplot(surv_fit, fun = "cumhaz", conf.int = TRUE, risk.table = TRUE)
```

На графике кумулятивной функции рисков время представлено на горизонтальной оси, в то время как вертикальная ось показывает риск наступления интересующего события. Это демонстрирует динамику изменения риска со временем.

Изображение на графике показывает, что доверительные интервалы для двух анализируемых групп имеют область пересечения, и сам график риска для этих групп также имеет точки пересечения. Это указывает на возможное отсутствие статистически значимых различий в уровнях риска между группами, разделенными на основе полового признака.

# регрессия Кокса
```{r}
cox_reg <- coxph(Surv(time, status) ~ sex, data = df_dead)
summary(cox_reg)
```

Исходя из полученных данных, p-value равно 0.136, что свидетельствует о статистически незначимых различиях между группами, разделёнными по половому признаку, поскольку p-value превышает пороговое значение alpha.

Кроме того, мы можем оценить разницу в риске между группами, исходя из коэффициента (coef) и его экспоненты (exp(coef)). В данном случае уровень относительного риска (exp(coef)) составляет 0.7779.

Пол оказывается значимым предиктором в статистическом анализе, так как p-value меньше 0.05. При этом коэффициент -0.53 указывает, что риск для женщин ниже по сравнению с мужчинами. Значение экспоненциального коэффициента (exp(coef)) составляет 0.5880. Это означает, что риск (hazard) для женщин на 41% ниже по сравнению с мужчинами.

```{r}
ggsurvplot(surv_fit(cox_reg, data = lung), data = df_dead)
```

